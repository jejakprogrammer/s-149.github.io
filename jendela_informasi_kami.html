<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Portal Berita" />
    <meta name="author" content="MR S-149" />
    <meta name="keyword" content="web, freelance, proggrammer, programming, laravel, IT, berita, tekhnologi, insiden, news, kejadian, jejakprogrammer, Jejak" />
    <title>JENDELA INFORMASI KAMI</title>
    <link href="jp.png" rel="icon" />
    <link href="jp.png" rel="apple-touch-icon" />
    <link rel="icon" href="jp.png" type="image/jpeg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0-beta3/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            margin-top: 56px;
        }
        
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        .carousel-caption h1,
        .carousel-caption p {
            display: inline-block;
            padding: 0.5rem;
        }
        
        .card {
            transition: transform 0.2s;
        }
        
        .card:hover {
            transform: scale(1.05);
        }
        
        .section-title {
            margin-top: 2rem;
            margin-bottom: 1.5rem;
            font-size: 1.75rem;
            text-align: center;
        }
        
        .select2-container--default .select2-selection--single {
            background-color: transparent;
            border: 0px solid #fff;
            margin-top: 5px;
            margin-bottom: 5px;
        }
        
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            color: #fff;
        }
        
        #pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }
        
        #pagination button {
            padding: 10px 15px;
            border-radius: 5px;
        }
        
        #pagination button:hover {
            background-color: #0056b3;
            /* Ganti dengan warna hover yang Anda inginkan */
            color: white;
            transition: background-color 0.3s;
        }
        
        #pagination span {
            font-weight: bold;
            margin: 0 10px;
        }
        
        a {
            text-decoration: none;
            color: rgb(100, 10, 246);
        }
        
        .news-container {
            max-height: 685px;
            /* Tentukan batas tinggi */
            overflow-y: auto;
            /* Aktifkan scroll */
            padding: 10px;
            border: 1px solid #ddd;
        }
        
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            /* Aspect Ratio 16:9 */
            height: 0;
            overflow: hidden;
        }
        
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        /* Style for the suggestion dropdown */
        
        .suggestions {
            border: 1px solid #ddd;
            max-height: 150px;
            overflow-y: auto;
            position: absolute;
            background-color: white;
            width: 100%;
            z-index: 1000;
        }
        
        .suggestion-item {
            padding: 10px;
            cursor: pointer;
        }
        
        .suggestion-item:hover {
            background-color: #f0f0f0;
        }
        /* Background with glowing effect */
        
        .bg-glow {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2), 0 6px 20px rgba(0, 0, 0, 0.15);
            padding: 20px;
        }
        
        .bg-glow::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(60deg, rgba(255, 255, 255, 0.3), rgba(0, 0, 0, 0.2));
            border-radius: 10px;
            z-index: -1;
        }
        /* Center text and icons */
        
        .text-center {
            text-align: center;
        }
        /* Background dengan efek highlight */
        
        .bg-highlight {
            background: linear-gradient(135deg, #3a6186, #89253e);
            border-radius: 15px;
        }
        /* Section title styling */
        
        .section-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4a4a40;
            text-transform: uppercase;
        }
        /* Text styling */
        
        .card-title {
            font-size: 2rem;
            color: #fdfdfd;
        }
        /* Card shadow and glow */
        
        .card.shadow-lg {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2), 0 6px 20px rgba(255, 255, 255, 0.15);
        }
        
        .text-light {
            color: #f8f9fa;
        }
        
        .lead {
            font-size: 1.25rem;
            font-weight: 300;
            color: #f1f1f1;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#"><img src="logo_transparant.png" width="200px" alt="logo"></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" id="home" href="#">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="about" href="#">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="">Berita</a>
                    </li>
                    <li class="nav-item">
                        <select class="form-select" id="categorySelect" aria-label="Select Kategori">
                          <option selected disabled>Kategori Berita</option>
                          <option value="">Berita Terbaru</option>
                        </select>
                    </li>
                </ul>
                <form id="searchForm">
                    <input type="text" class="form-control" id="searchQuery" placeholder="Search News..." autocomplete="off">
                    <div id="suggestions" class="suggestions"></div>
                </form>
            </div>
        </div>
    </nav>

    <div id="carouselExampleIndicators" class="carousel slide mt-4" data-bs-ride="carousel">
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
            <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
            <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
        </div>
        <div class="carousel-inner" id="carouselItems"></div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
            <span class="visually-hidden">Next</span>
        </button>
    </div>
    <section id="content" class="mb-4">
        <div class="container">
            <div class="row">
                <!-- Konten pertama -->
                <div class="col-md-8">
                    <section class="container mt-5">
                        <h2 class="section-title" id="latestNewsTitle">Berita Terbaru</h2>
                        <div class="row" id="latestNews">............</div>
                        <div id="pagination" class="mt-4"></div>
                    </section>
                </div>

                <!-- Konten kedua -->
                <div class="col-md-4">
                    <section class="container mt-5">
                        <h2 class="section-title" id="latestNewsTitle">Berita Hari ini</h2>
                        <div id="todayNews" class="row news-container">..............</div>
                    </section>
                </div>
            </div>
        </div>
        <section class="container mt-5">
            <h2 class="section-title">Berita Terpopuler</h2>
            <div class="row" id="popularNews">............</div>
        </section>
    </section>

    <footer style="background-color: #282c34; color: #ffffff; padding: 40px 20px; text-align: center;">
        <div style="max-width: 1200px; margin: auto;">
            <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 5px;">
                <img src="logo_transparant.png" alt="Logo" width="300px">
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-md-4">
                        <section class="container mt-5">
                            <h2 class="section-title">Link</h2>
                            <div class="row">
                                <ul style="list-style: none; padding: 0;">
                                    <li><a href="#" style="color: #ffffff; text-decoration: none;">Beranda</a></li>
                                    <li><a href="#" style="color: #ffffff; text-decoration: none;">Tentang Kami</a></li>
                                    <li><a href="#" style="color: #ffffff; text-decoration: none;">Layanan</a></li>
                                    <li><a href="#" style="color: #ffffff; text-decoration: none;">Kontak</a></li>
                                </ul>
                            </div>
                        </section>
                    </div>
                    <div class="col-md-4">
                        <section class="container mt-5">
                            <h2 class="section-title">Contact</h2>
                            <div class="row">
                                <p>
                                    <a href="https://api.whatsapp.com/send?phone=6285846761639&text=hallo%20jendela%20informasi" target="_blank"><img width="30px" src="cv/images/whatshapp-logo.png" alt="whatshapp-logo" />&nbsp; +62 858 4676 1639</a>
                                </p>
                                <p>
                                    <a href="mailto:jendelainformasikami@gmail.com" target="_blank"><img width="30px" src="cv/images/gmail-logo.png" alt="gmail-logo" />&nbsp; jendelainformasikami@gmail.com</a>
                                </p>
                            </div>
                        </section>
                    </div>
                    <div class="col-md-4">
                        <section class="container mt-5">
                            <h2 class="section-title">Follow</h2>
                            <div class="row">

                                <div style="display: flex; justify-content: center;">
                                    <a href="#" style="margin: 0 10px; color: #ffffff; text-decoration: none;">
                                        <i class="fab fa-facebook-f"></i>
                                    </a>
                                    <a href="#" style="margin: 0 10px; color: #ffffff; text-decoration: none;">
                                        <i class="fab fa-twitter"></i>
                                    </a>
                                    <a href="#" style="margin: 0 10px; color: #ffffff; text-decoration: none;">
                                        <i class="fab fa-instagram"></i>
                                    </a>
                                    <a href="https://www.youtube.com/@jendelainformasikami" style="margin: 0 10px; color: #ffffff; text-decoration: none;" target="_blank">
                                        <i class="fab fa-youtube"></i>
                                    </a>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
            <hr style="border: 1px solid #ffffff; margin: 20px 0;">
            <p>&copy; <span id="currentYear"></span> Copyright <strong>Jendela informasi kami</strong> All Rights Reserved</p>
            <p>Designed by <a href="https://s-149.github.io/" target="_blank">JejakProgrammer</a></p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script>
        const apiKey = 'AIzaSyCLW9miHFxA3M9kZ2VuDn419_xEShpD28A';
        const spreadsheetId = '1ZysJHFiIt9zUm5W0H-wUpOpPOlNo_5MlTZTcFFF_zEM';

        // Variabel global untuk pagination
        let itemsPerPage = 6; // Jumlah berita per halaman
        let currentPage = 1; // Halaman awal

        // Mengambil tahun saat ini
        const currentYear = new Date().getFullYear();
        document.getElementById('currentYear').textContent = currentYear;

        // Dapatkan elemen link dan elemen konten
        const contentSection = document.getElementById("content");
        const aboutLink = document.getElementById("about");

        // Tambahkan event listener pada link
        aboutLink.addEventListener("click", function(event) {
            // Mencegah link untuk melakukan reload halaman
            event.preventDefault();

            // Ubah konten dalam elemen #content
            contentSection.innerHTML = `
              <div class="container">
              <div class="row">
                  <div class="col-md-12">
                      <section class="container mt-5">
                          <h1 class="section-title text-center">Tentang Kami</h1>
                          <div class="col-md-12 mb-4">
                              <div class="card shadow-sm bg-glow">
                                  <div class="card-body">
                                      <h3 class="card-title text-center"><i class="fas fa-window"></i> Jendela Informasi Kami</h3>
                                      <p class="card-text text-center">"Portal kami hadir sebagai sumber informasi terpercaya, menghubungkan Anda dengan berita terbaru dan analisis mendalam dari berbagai bidang. Dari politik, ekonomi, hingga gaya hidup dan teknologi, kami berkomitmen untuk menyajikan informasi yang akurat, relevan, dan tepat waktu, semua dalam satu platform."</p>
                                      <hr>
                                      <div class="mt-4">
                                          <h4 class="card-subtitle"><i class="fas fa-eye"></i> Visi</h4>
                                          <p class="card-text">"Menjadi pusat informasi terpercaya yang menginspirasi dan mencerdaskan pembaca di era digital."</p>
                                      </div>
                                      <div class="mt-4">
                                          <h4 class="card-subtitle"><i class="fas fa-bullseye"></i> Misi</h4>
                                          <ul class="card-text">
                                              <li><i class="fas fa-check-circle text-primary"></i> Menyajikan berita faktual dan terkini dari seluruh dunia.</li>
                                              <li><i class="fas fa-check-circle text-primary"></i> Mengutamakan jurnalisme berintegritas dan berimbang.</li>
                                              <li><i class="fas fa-check-circle text-primary"></i> Memberikan perspektif mendalam yang relevan bagi pembaca.</li>
                                          </ul>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </section>
                  </div>
              </div>
          </div>

                `;
        });

        // Dapatkan elemen link dan elemen konten
        const homeLink = document.getElementById("home");

        // Tambahkan event listener pada link
        homeLink.addEventListener("click", function(event) {
            // Mencegah link untuk melakukan reload halaman
            event.preventDefault();

            // Ubah konten dalam elemen #content
            contentSection.innerHTML = `
              <div class="container">
              <div class="row">
                  <div class="col-md-12">
                      <section class="container mt-5 text-center">
                          <h1 class="section-title mb-4"><i class="fas fa-globe"></i> Portal Berita Terkini</h1>
                          <div class="col-md-12 mb-4">
                              <div class="card shadow-lg border-0 bg-highlight text-light">
                                  <div class="card-body p-5">
                                      <h3 class="card-title display-5 mb-3"><i class="fas fa-door-open"></i> Selamat Datang di Jendela Informasi Kami!</h3>
                                      <p class="card-text lead">Dapatkan berita terbaru dan terpercaya dari seluruh penjuru dunia! Kami menyajikan rangkaian informasi mendalam untuk memenuhi kebutuhan Anda akan berita terkini, dari isu nasional hingga peristiwa global.</p>
                                      <hr class="my-4" style="border-top: 1px solid #ffffff50;">
                                      <p class="card-text lead">Setiap berita adalah jendela untuk memahami dunia. Tim kami berdedikasi untuk menghadirkan berita yang akurat dan berimbang, memberi Anda perspektif yang luas dalam setiap informasi. Mari jelajahi wawasan baru, kapan pun dan di mana pun, bersama kami!</p>
                                  </div>
                              </div>
                          </div>
                      </section>
                  </div>
              </div>
          </div>
                `;
        });

        async function fetchData(range) {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;
            const response = await fetch(url);
            const data = await response.json();
            return data.values;
        }

        async function displayCategories() {
            const categorySelect = $('#categorySelect');
            const data = await fetchData('Kategori');
            const categories = data.slice(1);

            categories.forEach(row => {
                categorySelect.append(new Option(row[1], row[1]));
            });

            categorySelect.select2();

            categorySelect.on('change', async function() {
                const selectedCategory = $(this).val();
                await displayNews(selectedCategory, 'category');
            });
        }

        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '..';
        }

        function convertYouTubeUrlToEmbed(url) {
            const regex = /^(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})$/;
            const match = url.match(regex);
            if (match && match[1]) {
                return `https://www.youtube.com/embed/${match[1]}`;
            } else {
                throw new Error('Invalid YouTube URL');
            }
        }

        /**
         * Membuat elemen HTML untuk kartu berita.
         *
         * @param {number} id - ID unik berita yang akan digunakan dalam fungsi `showSingleNews`.
         * @param {string} thumbnailUrl - URL gambar thumbnail untuk berita.
         * @param {string} title - Judul berita yang akan ditampilkan.
         * @param {string} shortDescription - Deskripsi singkat berita yang akan ditampilkan.
         * @returns {string} - Kode HTML untuk kartu berita.
         */
        function createNewsCard(col, id, imageUrl, maxHeightImg, title, description) {
            const imageId = imageUrl.split('id=')[1]; // mendapatkan id image
            const thumbnailUrl = `https://drive.google.com/thumbnail?id=${imageId}`; // convert agar tampil sebagai thumbnail
            const shortDescription = truncateText(description, 50);
            return `
                  <div class="col-md-${col} mb-4">
                      <div class="card shadow-sm">
                          <img src="${thumbnailUrl}" class="card-img-top" alt="${title}" style="max-height: ${maxHeightImg}px;">
                          <div class="card-body">
                              <h5 class="card-title">${title}</h5>
                              <p class="card-text">${shortDescription}</p>
                              <a href="#" class="btn btn-primary" onclick="showSingleNews(${id})">Read More</a>
                          </div>
                      </div>
                  </div>`;
        }

        function addPaginationButtons(currentPage, totalPages, filter, type, onlyOne, selectedRow) {
            const paginationContainer = document.getElementById('pagination');
            paginationContainer.innerHTML = ''; // Reset pagination buttons

            // Tambahkan tombol "Previous"
            const prevButton = document.createElement('button');
            prevButton.innerHTML = `<i class="fas fa-chevron-left"></i> Previous`;
            prevButton.className = 'btn btn-secondary mx-1';
            prevButton.disabled = currentPage === 1;
            prevButton.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    displayNews(filter, type, onlyOne, selectedRow);
                }
            };
            paginationContainer.appendChild(prevButton);
            const nextButton = document.createElement('button');
            nextButton.innerHTML = `Next <i class="fas fa-chevron-right"></i>`;
            nextButton.className = 'btn btn-secondary mx-1';
            nextButton.disabled = currentPage === totalPages;
            nextButton.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    displayNews(filter, type, onlyOne, selectedRow);
                }
            };
            paginationContainer.appendChild(nextButton);
        }

        document.addEventListener('DOMContentLoaded', async function() {
            const searchQuery = document.getElementById('searchQuery');
            const suggestionsBox = document.getElementById('suggestions');
            const newsContainer = document.getElementById('latestNews');
            let newsData = [];
            const range = 'Berita!A2:F'; // Sesuaikan range sheet jika berbeda

            // Fungsi untuk mengambil data dari Google Sheets menggunakan Google Sheets API
            async function fetchDataFromSheet() {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;

                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    const data = await response.json();
                    console.log(data.values); // Log data untuk debugging
                    return data.values; // Mengembalikan nilai dari sheet (array 2D)
                } catch (error) {
                    console.error('Error fetching data from Google Sheets:', error);
                    return [];
                }
            }

            // Fungsi untuk menampilkan suggestions berdasarkan input user
            searchQuery.addEventListener('input', function() {
                const query = searchQuery.value.trim().toLowerCase();
                suggestionsBox.innerHTML = '';

                if (query.length > 1) {
                    const filteredData = newsData
                        .filter(row => row[1].toLowerCase().includes(query)) // Filter berdasarkan judul berita
                        .map(row => row[1]); // Ambil hanya kolom judul untuk disaring duplikasi

                    const uniqueSuggestions = Array.from(new Set(filteredData)); // Hapus duplikasi judul

                    if (uniqueSuggestions.length > 0) {
                        uniqueSuggestions.forEach(title => {
                            const suggestionItem = document.createElement('div');
                            suggestionItem.classList.add('suggestion-item');
                            suggestionItem.textContent = title;
                            suggestionItem.addEventListener('click', () => {
                                searchQuery.value = title; // Set value dari judul yang dipilih
                                suggestionsBox.innerHTML = ''; // Bersihkan suggestions
                                displayNews(title); // Panggil fungsi untuk menampilkan semua berita dengan judul yang dipilih
                            });
                            suggestionsBox.appendChild(suggestionItem);
                        });
                    } else {
                        const noResultItem = document.createElement('div');
                        noResultItem.classList.add('suggestion-item');
                        noResultItem.textContent = 'No results found';
                        suggestionsBox.appendChild(noResultItem);
                    }
                }
            });

            // Fungsi untuk menampilkan semua berita dengan judul yang cocok dari suggestions
            function displayNews(selectedTitle) {
                const filteredNews = newsData.filter(row => row[1] === selectedTitle); // Temukan semua berita dengan judul yang sama
                const paginationContainer = document.getElementById('pagination');

                // Reset tampilan
                newsContainer.innerHTML = '';
                paginationContainer.innerHTML = '';
                const titleElement = document.getElementById('latestNewsTitle');
                titleElement.textContent = `Hasil Pencarian untuk "${selectedTitle}"`;

                if (filteredNews.length === 0) {
                    newsContainer.innerHTML = '<p>Data tidak ditemukan sesuai pencarian.</p>';
                    return;
                }

                // Render berita yang ditemukan
                filteredNews.forEach(row => {
                    const [id, title, description, konten, imageUrl, category] = row;
                    const newsItem = `
                              <p><a href="#" onclick="showSingleNews(${id})">${title}, ${konten}</a></p>`;

                    // createNewsCard(6, id, imageUrl, 400, title, description);
                    newsContainer.innerHTML += newsItem; // Tambahkan ke container
                });

            }

            // Memuat data dari spreadsheet saat halaman pertama kali dimuat
            newsData = await fetchDataFromSheet();
        });

        async function displayNews(filter = '', type = 'latest', onlyOne = false, selectedRow = null) {
            const newsContainer = document.getElementById('latestNews');
            const paginationContainer = document.getElementById('pagination');
            const titleElement = document.getElementById('latestNewsTitle');

            // Ubah judul
            const title = type === 'category' && filter ? `Berita ${filter}` : 'Berita Terbaru';
            titleElement.textContent = title;

            const data = await fetchData('Berita'); // Ambil data berita

            // Cek apakah data berhasil diambil
            if (!data || data.length === 0) {
                newsContainer.innerHTML = '<p>Data berita tidak ditemukan.</p>';
                return;
            }

            // Reset tampilan
            newsContainer.innerHTML = '';
            paginationContainer.innerHTML = '';

            // Filter data berdasarkan kategori jika filter diberikan, jika tidak, tampilkan semua data
            let filteredData = filter ? data.filter(row => row[7] === filter) : data.slice(1);

            // Balik urutan data
            const reversedData = filteredData.reverse();
            const totalPages = Math.ceil(reversedData.length / itemsPerPage);

            // Tampilkan data untuk halaman saat ini
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentItems = reversedData.slice(startIndex, endIndex);

            if (currentItems.length === 0) {
                newsContainer.innerHTML = '<p>Data tidak ditemukan sesuai pencarian.</p>';
                return;
            }

            // Render berita untuk halaman saat ini
            currentItems.forEach((row, index) => {
                const adjustedIndex = startIndex + index;
                const newsItem = createNewsCard(4, row[0], row[4], 100, row[1], row[2]);
                newsContainer.innerHTML += newsItem;
            });

            // Tambahkan tombol "Previous" dan "Next"
            const prevButton = document.createElement('button');
            prevButton.innerHTML = `<i class="fas fa-chevron-left"></i> Previous`;
            prevButton.className = 'btn btn-secondary mx-1';
            prevButton.disabled = currentPage === 1;
            prevButton.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    displayNews(filter, type, onlyOne, selectedRow);
                }
            };
            paginationContainer.appendChild(prevButton);

            // Menampilkan nomor halaman yang aktif dengan batasan 3 halaman
            const maxVisiblePages = 1; // Munculkan 3 halaman di sekitar currentPage
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

            // Adjust jika halaman awal atau akhir dekat dengan batas
            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }

            // Tombol halaman pertama dan "..."
            if (startPage > 1) {
                const firstPageButton = document.createElement('button');
                firstPageButton.className = 'btn btn-secondary mx-1';
                firstPageButton.innerText = 1;
                firstPageButton.onclick = () => {
                    currentPage = 1;
                    displayNews(filter, type, onlyOne, selectedRow);
                };
                paginationContainer.appendChild(firstPageButton);

                if (startPage > 2) {
                    const dots = document.createElement('span');
                    dots.innerText = '...';
                    paginationContainer.appendChild(dots);
                }
            }

            // Tombol nomor halaman
            for (let page = startPage; page <= endPage; page++) {
                const pageButton = document.createElement('button');
                pageButton.className = 'btn btn-secondary mx-1';
                pageButton.innerText = page;
                pageButton.disabled = page === currentPage; // Disable tombol untuk halaman aktif
                pageButton.onclick = () => {
                    currentPage = page;
                    displayNews(filter, type, onlyOne, selectedRow);
                };
                paginationContainer.appendChild(pageButton);
            }

            // Tombol halaman terakhir dan "..."
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const dots = document.createElement('span');
                    dots.innerText = '...';
                    paginationContainer.appendChild(dots);
                }

                const lastPageButton = document.createElement('button');
                lastPageButton.className = 'btn btn-secondary mx-1';
                lastPageButton.innerText = totalPages;
                lastPageButton.onclick = () => {
                    currentPage = totalPages;
                    displayNews(filter, type, onlyOne, selectedRow);
                };
                paginationContainer.appendChild(lastPageButton);
            }

            // Tambahkan tombol "Next"
            const nextButton = document.createElement('button');
            nextButton.innerHTML = `Next <i class="fas fa-chevron-right"></i>`;
            nextButton.className = 'btn btn-secondary mx-1';
            nextButton.disabled = currentPage === totalPages;
            nextButton.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    displayNews(filter, type, onlyOne, selectedRow);
                }
            };
            paginationContainer.appendChild(nextButton);
        }

        function displaySingleNews(row, container) {
            const newsItem = createNewsCard(4, row[0] - 1, row[4], row[1], row[1]);
            container.innerHTML += newsItem;
        }

        async function todayNews() {
            const newsContainer = document.getElementById('todayNews');
            const data = await fetchData('Berita');

            const now = new Date();
            const today = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;

            newsContainer.innerHTML = '';

            // Filter berita berdasarkan tanggal hari ini
            const filteredNews = data.slice(1).filter((row) => {
                const rowDate = new Date(row[5]);
                const formattedRowDate = `${rowDate.getFullYear()}-${String(rowDate.getMonth() + 1).padStart(2, '0')}-${String(rowDate.getDate()).padStart(2, '0')}`;
                // console.log(`Waktu sistem : ${formattedRowDate}`);
                return formattedRowDate === today;
            });

            // Batasi hanya menampilkan 5 berita
            filteredNews.slice(0).forEach((row, index) => {
                const shortDescription = truncateText(row[2], 50); // Panggil fungsi untuk memotong teks

                // Mengonversi URL Google Drive ke format thumbnail
                const imageId = row[4].split('id=')[1]; // Ambil ID dari URL
                const thumbnailUrl = `https://drive.google.com/thumbnail?id=${imageId}`; // Buat URL thumbnail

                const newsItem = createNewsCard(12, row[0], row[4], 150, row[1], row[2]);
                newsContainer.innerHTML += newsItem;
            });
        }

        async function showSingleNews(index) {
            const data = await fetchData('Berita');
            const row = data[index]; // +1 karena data[0] adalah header
            const newsContainer = document.getElementById('latestNews');
            const imageId = row[4].split('id=')[1]; // Ambil ID dari URL
            const thumbnailUrl = `https://drive.google.com/thumbnail?id=${imageId}`; // Buat URL thumbnail
            const short = truncateText(row[8], 30);
            const youtubeConvert = convertYouTubeUrlToEmbed(row[12]);

            newsContainer.innerHTML = `
            <div class="col-12 mb-4">
                <div class="card shadow-sm">
                    <img src="${thumbnailUrl}" class="card-img-top" alt="${row[1]}">
                    <div class="card-body">
                        <h5 class="card-title">${row[1]}</h5>
                        <p class="card-text">${row[3]}</p>
                        <p class="card-text" style="text-align: justify;">${row[2]}</p>
                        <p class="card-text" style="text-align: justify;">
                            <div class="video-container">
                                <iframe src="${youtubeConvert}" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </p>
                        <p class="card-text" style="text-align: justify; color: blue;">Tags ${row[11]}</p>
                        <p class="card-text">
                            <table>
                                <tr>
                                    <th>Sumber</th>
                                    <td>:</td>
                                    <td>${row[6]}</td>
                                </tr>
                                <tr>
                                    <th>Kategori</th>
                                    <td>:</td>
                                    <td>${row[7]}</td>
                                </tr>
                                <tr>
                                    <th>Link Sumber</th>
                                    <td>:</td>
                                    <td><a href="${row[8]}" target="_blank">${short}</a></td>
                                </tr>
                            </table>
                        </p>
                        <a href="#" class="btn btn-secondary" onclick="displayNews()">Back</a>
                    </div>
                </div>
            </div>`;
        }

        async function displayPopularNews() {
            try {
                const commentsData = await fetchData('Komentar');
                const newsData = await fetchData('Berita');

                if (!commentsData || !Array.isArray(commentsData)) {
                    console.error('Data Komentar tidak valid:', commentsData);
                    return;
                }
                if (!newsData || !Array.isArray(newsData)) {
                    console.error('Data Berita tidak valid:', newsData);
                    return;
                }

                const commentCounts = {};
                commentsData.forEach((comment) => {
                    const newsId = comment[1];
                    commentCounts[newsId] = (commentCounts[newsId] || 0) + 1;
                });

                const newsWithComments = newsData.map((news) => {
                    const newsId = news[0];
                    return {
                        id: newsId,
                        title: news[1],
                        description: news[2],
                        image: news[4],
                        commentCount: commentCounts[newsId] || 0
                    };
                });

                const popularNews = newsWithComments.sort((a, b) => b.commentCount - a.commentCount);
                const topNews = popularNews.slice(0, 3);

                const newsContainer = document.getElementById('popularNews');
                newsContainer.innerHTML = '';

                topNews.forEach((newsItem) => {
                    const newsHTML = createNewsCard(4, newsItem.id, newsItem.image, 200, newsItem.title, newsItem.description);
                    newsContainer.innerHTML += newsHTML;
                });
            } catch (error) {
                console.error('Error saat menampilkan berita:', error);
            }
        }

        async function displayCarousel() {
            const carouselItemsContainer = document.getElementById('carouselItems');
            const data = await fetchData('Carousel');

            if (data.length > 1) {
                data.slice(1).forEach((row, index) => {
                    const activeClass = index === 0 ? 'active' : '';
                    const carouselItem = `
                    <div class="carousel-item ${activeClass}">
                        <img src="${row[2]}" class="d-block w-100" alt="${row[2]}" style="max-height: 400px;">
                        <div class="carousel-caption d-none d-md-block">
                            <h1>${row[1]}</h1>
                        </div>
                    </div>`;
                    carouselItemsContainer.innerHTML += carouselItem;
                });
            }
        }

        document.addEventListener('DOMContentLoaded', displayPopularNews);
        document.addEventListener('DOMContentLoaded', todayNews);
        document.addEventListener('DOMContentLoaded', function() {
            // Get the element for the link
            const latestNewsLink = document.getElementById('latestNewsLink');

            // Check if the element exists and add a click event listener
            if (latestNewsLink) {
                latestNewsLink.addEventListener('click', function(event) {
                    event.preventDefault(); // Prevent default behavior of the link

                    // Reset the current page to 1 (start from the first page)
                    currentPage = 1;
                    title = 'Berita Terbaru';

                    // Call the function to display the latest news (default)
                    displayNews(); // No filter or special type to get the default news
                });
            }
        });

        $(document).ready(async function() {
            await displayCategories();
            await displayNews();
            await displayCarousel();
            await todayNews();
        });
    </script>
</body>

</html>
